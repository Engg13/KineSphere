<ion-header [translucent]="true" class="ion-no-border custom-header-container">
  <div class="custom-header">
    <div class="main-title">
      <h1>Registro de Sesi√≥n</h1>
    </div>
    <div class="subtitle">
      <!-- Mostrar nombre din√°mico -->
      @if (pacienteNombre && pacienteNombre !== 'Paciente') {
        <p>Sesi√≥n {{ numeroSesion }} - {{ pacienteNombre }}</p>
      } @else {
        <p>Sesi√≥n {{ numeroSesion }}</p>
        <ion-note color="warning">Paciente no especificado</ion-note>
      }
    </div>
  </div>
</ion-header>

<ion-content [fullscreen]="true" (click)="onContentClick($event)">
  <div class="ion-padding">
    <!-- FORMULARIO DE SESI√ìN -->
    <ion-card class="animated-item">
      <!-- ENCABEZADO DEL CARD -->
      <ion-card-header>
        <ion-card-title>üìù Evaluaci√≥n</ion-card-title>
        <!-- Mostrar nombre del paciente si est√° disponible -->
        @if (pacienteNombre && pacienteNombre !== 'Paciente') {
          <ion-card-subtitle>
            <ion-icon name="person" slot="start"></ion-icon>
            {{ pacienteNombre }}
          </ion-card-subtitle>
        }
      </ion-card-header>
      
      <!-- CONTENIDO DEL CARD -->
      <ion-card-content>
        <!-- ESCALA EVA CON BARRA DE RANGO -->
        <div class="seccion-formulario">
          <ion-item>
            <ion-label position="stacked">
              <strong>Nivel de Dolor (EVA)</strong>
              <p class="descripcion">Selecciona tu nivel de dolor actual (0-10)</p>
            </ion-label>
            <ion-range
              [(ngModel)]="sesionData.nivelDolor"
              min="0"
              max="10"
              step="1"
              snaps="true"
              ticks="true"
              class="eva-range">
              <ion-label slot="start">0</ion-label>
              <ion-label slot="end">10</ion-label>
            </ion-range>
            @if (sesionData.nivelDolor !== null) {
              <ion-badge slot="end" color="primary">
                {{sesionData.nivelDolor}}/10
              </ion-badge>
            }
          </ion-item>

          <!-- INDICADORES DE DOLOR -->
          <div class="indicadores-dolor">
            <span class="indicador">0: Sin dolor</span>
            <span class="indicador">5: Dolor moderado</span>
            <span class="indicador">10: M√°ximo dolor</span>
          </div>
        </div>

        <!-- CALIDAD DE SUE√ëO COMPACTA -->
        <div class="componente-sesion">
          <app-sleep-quality
            [(valor)]="sesionData.calidadSueno"
            [titulo]="'Calidad del Sue√±o'"
            [descripcion]="'¬øC√≥mo califica la calidad de su sue√±o durante la √∫ltima noche?'">
          </app-sleep-quality>
        </div>

        <!-- EJERCICIOS EN CASA -->
        <div class="seccion-formulario">
          <ion-item>
            <ion-label>¬øRealiz√≥ los ejercicios en casa?</ion-label>
            <ion-checkbox slot="start" [(ngModel)]="sesionData.ejerciciosRealizados"></ion-checkbox>
          </ion-item>
        </div>

        <!-- OBSERVACIONES -->
        <div class="seccion-formulario">
          <ion-item>
            <ion-label position="stacked">Observaciones de la sesi√≥n</ion-label>
            <ion-textarea
              #observacionesTextarea
              [(ngModel)]="sesionData.observaciones"
              placeholder="Registre observaciones relevantes, progresos, dificultades..."
              rows="3"
              autoGrow="true"
              enterkeyhint="done"
              (keydown.enter)="onEnterObservaciones($event)">
            </ion-textarea>
            
            <!-- Nota de ayuda -->
            <ion-note slot="helper" color="medium" style="font-size: 0.8rem;">
              Presiona "Listo" para cerrar teclado
            </ion-note>
          </ion-item>
        </div>
      </ion-card-content>
    </ion-card>

    <!-- ESPACIO PARA LOS BOTONES FIJOS -->
    <div class="botones-spacer"></div>
  </div>

  <!-- BOTONES FIJOS -->
  <div class="botones-fijos">
    <ion-grid>
      <ion-row>
        <ion-col size="6">
          <ion-button
            expand="block"
            (click)="guardarSesion()"
            [disabled]="!esFormularioValido()">
            üíæ Guardar Sesi√≥n
          </ion-button>
        </ion-col>
        <ion-col size="6">
          <ion-button
            expand="block"
            fill="outline"
            (click)="volverAPaciente()">
            ‚Üê Volver
          </ion-button>
        </ion-col>
      </ion-row>
    </ion-grid>
  </div>
</ion-content>