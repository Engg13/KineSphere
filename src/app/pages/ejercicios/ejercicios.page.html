<ion-header>
  <ion-toolbar color="primary">
    <ion-title>
      <ion-icon name="barbell-outline" slot="start"></ion-icon>
      Biblioteca de Ejercicios
    </ion-title>
  </ion-toolbar>
</ion-header>

<ion-content class="ion-padding">
  <!-- BOTÓN DE VOLVER EN LA PARTE SUPERIOR DEL CONTENIDO -->
  <div class="back-button-container" style="margin-bottom: 20px;">
    <ion-button (click)="volverAtras()" fill="outline" color="medium">
      <ion-icon name="arrow-back" slot="start"></ion-icon>
      Volver
    </ion-button>
  </div>

  <!-- BÚSQUEDA -->
  <div class="search-section">
    <ion-searchbar
      [(ngModel)]="terminoBusqueda"
      (ionChange)="filtrarEjercicios()"
      placeholder="Buscar ejercicios..."
      animated>
    </ion-searchbar>
  </div>

  <!-- ESTADOS -->
  @if (!loading.ejercicios && !error) {
    <!-- SIN RESULTADOS -->
    @if (hayResultadosBusqueda) {
      <div class="no-results">
        <ion-icon name="fitness-outline"></ion-icon>
        <h3>No hay coincidencias</h3>
        <p>No encontramos ejercicios con "{{terminoBusqueda}}"</p>
        <ion-button fill="clear" (click)="limpiarBusqueda()">
          Ver todos
        </ion-button>
      </div>
    }
    <!-- LISTA - SOLO SI HAY EJERCICIOS -->
    @if (ejerciciosFiltrados && ejerciciosFiltrados.length > 0) {
      <ion-list lines="none">
        @for (ejercicio of ejerciciosFiltrados; track trackById($index, ejercicio)) {
          <ion-item
            (click)="seleccionarEjercicio(ejercicio)"
            button
            detail>
            <ion-icon
              slot="start"
              [name]="getExerciseIcon(ejercicio.categoria)"
              color="primary">
            </ion-icon>
            <ion-label>
              <h2>{{ejercicio.nombre}}</h2>
              <p>{{ejercicio.descripcion | slice:0:100}}...</p>
              <div>
                <ion-badge color="light">
                  {{obtenerNombreCategoria(ejercicio.categoria)}}
                </ion-badge>
              </div>
            </ion-label>
          </ion-item>
        }
      </ion-list>
    }
  } @else {
    <!-- LOADING STATE -->
    @if (loading.ejercicios) {
      <div class="loading-state">
        <ion-spinner name="crescent"></ion-spinner>
        <p>Cargando ejercicios...</p>
      </div>
    }
    <!-- ERROR STATE -->
    @if (error && !loading.ejercicios) {
      <div class="error-state">
        <ion-icon name="cloud-offline-outline"></ion-icon>
        <h3>Error</h3>
        <p>{{error}}</p>
        <ion-button (click)="recargarDatos()">
          Reintentar
        </ion-button>
      </div>
    }
  }

  <!-- LOADING/ERROR TEMPLATE -->
</ion-content>